{%  extends "LouvreBundle:home:index.html.twig" %}

{% block body %}
    <div class="row">
        <div class="col-xs-12" id="recap">

            {{ "Your order summary :"|trans }}
            {{ commande.name }}
            <br/>
            {{ commande.email }}
            <br/>
            {{ commande.date|date('d/m/Y') }}
            <br/>
          {#  {% if not commande.duree %}
                {{ "Full day"|trans }}
            {% else %}
                {{ "Half-day"|trans }}
            {% endif %}
            #}
            {{ commande.duree? "Half-day"|trans: "Full day"|trans }}

            <br/>
            <table>
                <caption>{{ "Tickets in your order"|trans }}</caption>
                <thead>
                <tr>
                    <th>{{ "Name"|trans }}</th>
                    <th>{{ "Surname"|trans }}</th>
                    <th>{{ "Country"|trans }}</th>
                    <th>{{ "Pricing"|trans }}</th>
                    <th>{{ "Price"|trans }}</th>
                </tr>
                </thead>
                <tfoot>
                <tr>
                    <th colspan="4">{{ "Total"|trans }}</th>
                    <th>
                        {% set orderAmountScreen = orderAmount / 100 %}
                        {{ orderAmountScreen }}
                    </th>
                </tr>
                </tfoot>
                <tbody>

                {% for ticket in commande.tickets %}
                    {#{{ ticket.id }}#}
                    <tr>
                        <td>{{ ticket.name }}</td>
                        <td>{{ ticket.surname }}</td>
                        <td>{{ ticket.country }}</td>
                        <td>
                            {{ ticket.price.name|trans }}
                        </td>

                        <td> {{ commande.duree? ticket.price.value/2: ticket.price.value }}</td>
                    </tr>
                {% endfor %}

                </tbody>
            </table>


        </div>
    </div>
<div class="row" id="options">
    <div class="col-xs-offset-3 col-xs-6">

    {% if commande.status != 'pay_success'%}
        <a href="{{ path('editOrder', {'name': commande.name}) }}" class="btn btn-warning btn-block">{{ "Edit my order"|trans }}</a>

    <br/>
    <form action="./{{ commande.name }}" method="post">
        <input
                id="payerStripe"
                class="btn btn-success"
                type="submit"
                value="{{ "paiement"|trans }}"
                data-key="pk_test_C0r7dLtkZzK1tF6oPxBGYxmK"
                data-amount="{{ orderAmount }}"
                data-email="{{ commande.email }}"
                data-currency="eur"
                data-name="Louvre"
                data-allow-remember-me="false"
                data-description="{{ "paiement"|trans }}"

        />
    </form>

    {% else %}
        {{ 'order.payed'|trans }}

        {% set order_resume = path('resumeOrder', {'name': commande.name}) %}
        <img src="https://chart.googleapis.com/chart?cht=qr&chs=200x200&chl={{ order_resume }}" />
        <br/>
        <a href="{{ path('home') }}" class="btn btn-success btn-block" >{{ "Home"|trans }}</a>
    {% endif %}
</div>
    </div>
{% endblock %}


{% block javascripts %}
    <script src="https://checkout.stripe.com/v2/checkout.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.js"></script>
    <script>
        $(document).ready(function() {
            $(':submit').on('click', function(event) {
                event.preventDefault();
                var $button = $(this),
                        $form = $button.parents('form');
                var opts = $.extend({}, $button.data(), {
                    token: function(result) {
                        $form.append($('<input>').attr({ type: 'hidden', name: 'stripeToken', value: result.id })).submit();
                    }
                });
                StripeCheckout.open(opts);
            });
            $('.interieur').removeClass('interieur');
            $('.corps').css('display','block');
            $('.row .corps').addClass('col-lg-offset-1');
        });

    </script>
{% endblock %}
